###########################################################################
# 
#  Copyright 2019 Google Inc.
#
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.
#
###########################################################################

'''
Dynamic Costs Reporting

Calculate DBM cost at the dynamic creative combination level.

A
d
d
 
a
 
s
h
e
e
t
 
U
R
L
.
 
T
h
i
s
 
i
s
 
w
h
e
r
e
 
y
o
u
 
w
i
l
l
 
e
n
t
e
r
 
a
d
v
e
r
t
i
s
e
r
 
a
n
d
 
c
a
m
p
a
i
g
n
 
l
e
v
e
l
 
d
e
t
a
i
l
s
.


S
p
e
c
i
f
y
 
t
h
e
 
D
C
M
 
n
e
t
w
o
r
k
 
I
D
.


C
l
i
c
k
 
r
u
n
 
n
o
w
 
o
n
c
e
,
 
a
n
d
 
a
 
t
a
b
 
c
a
l
l
e
d
 
<
s
t
r
o
n
g
>
D
y
n
a
m
i
c
 
C
o
s
t
s
<
/
s
t
r
o
n
g
>
 
w
i
l
l
 
b
e
 
a
d
d
e
d
 
t
o
 
t
h
e
 
s
h
e
e
t
 
w
i
t
h
 
i
n
s
t
r
u
c
t
i
o
n
s
.


F
o
l
l
o
w
 
t
h
e
 
i
n
s
t
r
u
c
t
i
o
n
s
 
o
n
 
t
h
e
 
s
h
e
e
t
;
 
t
h
i
s
 
w
i
l
l
 
b
e
 
y
o
u
r
 
c
o
n
f
i
g
u
r
a
t
i
o
n
.


S
t
a
r
T
h
i
n
k
e
r
 
w
i
l
l
 
c
r
e
a
t
e
 
t
w
o
 
o
r
 
t
h
r
e
e
 
(
d
e
p
e
n
d
i
n
g
 
o
n
 
t
h
e
 
c
a
s
e
)
 
r
e
p
o
r
t
s
 
i
n
 
D
C
M
 
n
a
m
e
d
 
<
s
t
r
o
n
g
>
D
y
n
a
m
i
c
 
C
o
s
t
s
 
-
 
.
.
.
<
/
s
t
r
o
n
g
>
.


W
a
i
t
 
f
o
r
 
<
b
>
B
i
g
Q
u
e
r
y
-
>
U
N
D
E
F
I
N
E
D
-
>
U
N
D
E
F
I
N
E
D
-
>
D
y
n
a
m
i
c
_
C
o
s
t
s
_
A
n
a
l
y
s
i
s
<
/
b
>
 
t
o
 
b
e
 
c
r
e
a
t
e
d
 
o
r
 
c
l
i
c
k
 
R
u
n
 
N
o
w
.


C
o
p
y
 
<
a
 
h
r
e
f
=
'
h
t
t
p
s
:
/
/
d
a
t
a
s
t
u
d
i
o
.
g
o
o
g
l
e
.
c
o
m
/
o
p
e
n
/
1
v
B
v
B
E
i
M
b
q
C
b
B
u
J
T
s
B
G
p
e
g
8
v
C
L
t
g
6
z
t
q
A
'
 
t
a
r
g
e
t
=
'
_
b
l
a
n
k
'
>
D
y
n
a
m
i
c
 
C
o
s
t
s
 
S
a
m
p
l
e
 
D
a
t
a
 
(
 
C
o
p
y
 
F
r
o
m
 
T
h
i
s
 
)
<
/
a
>
.


C
l
i
c
k
 
E
d
i
t
 
C
o
n
n
e
c
t
i
o
n
,
 
a
n
d
 
C
h
a
n
g
e
 
t
o
 
<
b
>
B
i
g
Q
u
e
r
y
-
>
U
N
D
E
F
I
N
E
D
-
>
U
N
D
E
F
I
N
E
D
-
>
D
y
n
a
m
i
c
_
C
o
s
t
s
_
A
n
a
l
y
s
i
s
<
/
b
>
.


C
o
p
y
 
<
a
 
h
r
e
f
=
'
h
t
t
p
s
:
/
/
d
a
t
a
s
t
u
d
i
o
.
g
o
o
g
l
e
.
c
o
m
/
o
p
e
n
/
1
x
u
l
B
A
d
x
9
5
S
n
v
j
n
U
z
F
P
6
r
1
4
l
h
k
v
v
V
b
s
P
8
'
 
t
a
r
g
e
t
=
'
_
b
l
a
n
k
'
>
D
y
n
a
m
i
c
 
C
o
s
t
s
 
S
a
m
p
l
e
 
R
e
p
o
r
t
 
(
 
C
o
p
y
 
F
r
o
m
 
T
h
i
s
 
)
<
/
a
>
.


W
h
e
n
 
p
r
o
m
p
t
e
d
,
 
c
h
o
o
s
e
 
t
h
e
 
n
e
w
 
d
a
t
a
 
s
o
u
r
c
e
 
y
o
u
 
j
u
s
t
 
c
r
e
a
t
e
d
.


E
d
i
t
 
t
h
e
 
t
a
b
l
e
 
t
o
 
i
n
c
l
u
d
e
 
o
r
 
e
x
c
l
u
d
e
 
c
o
l
u
m
n
s
 
a
s
 
d
e
s
i
r
e
d
.


O
r
,
 
g
i
v
e
 
t
h
e
 
d
a
s
h
b
o
a
r
d
 
c
o
n
n
e
c
t
i
o
n
 
i
n
t
r
u
c
t
i
o
n
s
 
t
o
 
t
h
e
 
c
l
i
e
n
t
.

'''

from starthinker_airflow.factory import DAG_Factory
 
USER_CONN_ID = "google_cloud_default" # The connection to use for user authentication.
GCP_CONN_ID = "" # The connection to use for service authentication.

INPUTS = {
  'dcm_account': '',
  'configuration_sheet_url': '',
  'bigquery_dataset': 'dynamic_costs',
}

TASKS = [
  {
    'dynamic_costs': {
      'auth': 'user',
      'account': {
        'field': {
          'name': 'dcm_account',
          'kind': 'string',
          'order': 0,
          'default': ''
        }
      },
      'sheet': {
        'template': {
          'url': 'https://docs.google.com/spreadsheets/d/19J-Hjln2wd1E0aeG3JDgKQN9TVGRLWxIEUQSmmQetJc/edit?usp=sharing',
          'tab': 'Dynamic Costs',
          'range': 'A1'
        },
        'url': {
          'field': {
            'name': 'configuration_sheet_url',
            'kind': 'string',
            'order': 1,
            'default': ''
          }
        },
        'tab': 'Dynamic Costs',
        'range': 'A2:B'
      },
      'out': {
        'auth': 'service',
        'dataset': {
          'field': {
            'name': 'bigquery_dataset',
            'kind': 'string',
            'order': 2,
            'default': 'dynamic_costs'
          }
        }
      }
    }
  }
]

DAG_FACTORY = DAG_Factory('dynamic_costs', { 'tasks':TASKS }, INPUTS)
DAG_FACTORY.apply_credentails(USER_CONN_ID, GCP_CONN_ID)
DAG = DAG_FACTORY.execute()

if __name__ == "__main__":
  DAG_FACTORY.print_commandline()
