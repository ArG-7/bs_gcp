




<!DOCTYPE html>
<html>
  <head>

    <link rel="shortcut icon" href="https://storage.googleapis.com/starthinker-ui/favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://storage.googleapis.com/starthinker-ui/favicon.ico" type="image/x-icon">

    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet">
    <!--Import materialize.css-->
    <link rel="stylesheet" href="https://storage.googleapis.com/starthinker-ui/css/materialize.min.css">

    <style>
       html { color: rgba(68,68,68,1); text-shadow: 5px 5px 15px rgba(168,168,168,0.5); }
 
       .material-icons { line-height: normal; vertical-align: middle; }

       #message { justify-content: center; font-size: 2em;}
       #message i { font-size: 2em; margin: 10px; }
       #message ul, #message li { display: inline; margin-left: 10px; }
       #page { width: 100%; max-width: 1280px; min-height: 500px; margin: 0px auto; padding-bottom: 50px; }

       span.square_box {
         display: inline-block;
         width: 40px;
         height: 40px;
         border: 2px solid #fff;
         text-align: center;
         line-height: 40px;
         margin: 5px;
       }

       div.nav-wrapper { padding-left: 1%; padding-right: 1%; }
       h1 a i.material-icons { font-size: 3.28rem; }
       a.brand-logo img { vertical-align: middle; width: 40px; height: 40px; }
       ol li { line-height: 1.8em; }
       textarea { margin-top: 7px; height: 10rem; }
       table.list { width: 96%; max-width: 800px; margin: 1vh auto; line-height: 1.8em; }
       a.menu_link, span.menu_link { display: inline-block; margin: 2px; }
       a.btn { margin: 2px; }

       div.split { display: flex; align-items: flex-start; justify-content: center; flex-wrap: wrap; width: 100%; margin: 20px auto; }
       div.split_left { flex-grow: 1; flex-basis: 0; min-width: 300px; border-right: 1px solid #eee; padding: 20px; }
       div.split_right { flex-grow: 2; flex-basis: 0; min-width: 300px; padding: 20px; }

       div.service_card { min-height: 250px; width: 300px; margin: 10px;}
       div.service_callouts { display: flex; align-items: flex-start; justify-content: left; flex-wrap: wrap; width: 100%; }
       div.service_callout { min-width: 48%; margin-right: 2%; line-height: 2.4em;}
       div.row { display: flex; align-items: flex-start; justify-content: center; flex-wrap: wrap; }

       #cards { display: flex; align-items: flex-start; justify-content: center; flex-wrap: wrap; width: 100%; }
       #cards div.card { width: 300px; margin: 20px; padding: 0.1px; text-align: left; }
       div.card h4 { width 100%; padding: 20px;}
       div.card h4 i.material-icons { font-size: 2.28rem; }
       div.card table { margin: 0px 5% 30px 5%; width: 90%; }

       .card .card-content .card-title { word-wrap: break-word; }
       div.input-field { padding-top: 0.1px; margin-top: 2.4em;}

       
  #solution_image { margin: 30px auto; width: 80%; max-width: 800px; height: auto; display: block; }
  .btn-large { margin: 1vh 1vw; } 
  .col { margin-right: auto; }
  pre.expand_code { height: 70vh; }
  pre.expand_code span { position: absolute; right: 0px; margin: 15px; cursor: pointer; }

    </style>

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  </head>

  
  <nav class="green lighten-0">
    <div class="nav-wrapper">
      <a href="/starthinker/" class="brand-logo">
        <img src="https://storage.googleapis.com/starthinker-ui/StarThinker.png"/>&nbsp;StarThinker
      </a>
      <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
      <ul class="right hide-on-med-and-down">
        
        
        <li><a href="/starthinker/solution/">Solutions</a></li>
        
        
      </ul>
      <ul class="side-nav red lighten-1" id="mobile-demo">
        
        
        
        <li><a class="white-text" href="/starthinker/solution/">Solutions</a></li>
        
        
      </ul>
    </div>
  </nav>
  

  <body>
    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://storage.googleapis.com/starthinker-ui/js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="https://storage.googleapis.com/starthinker-ui/js/materialize.min.js"></script>

    
<!--
Start of Floodlight Tag: Please do not remove
Activity name of this tag: Gallery Conversions
URL of the webpage where the tag is expected to be placed: https://google.github.io/starthinker/
This tag must be placed between the <body> and </body> tags, as close as possible to the opening tag.
Creation Date: 03/09/2020
-->
<script type="text/javascript">
var axel = Math.random() + "";
var a = axel * 10000000000000;
document.write('<img src="https://ad.doubleclick.net/ddm/activity/src=8657867;type=github;cat=galle0;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;npa=;ord=' + a + '?" width="1" height="1" alt=""/>');
</script>
<noscript>
<img src="https://ad.doubleclick.net/ddm/activity/src=8657867;type=github;cat=galle0;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;npa=;ord=1?" width="1" height="1" alt=""/>
</noscript>
<!-- End of Floodlight Tag: Please do not remove -->



    

    <div id="page" class="center">
      

  <br/>
  <h1><i class="medium material-icons">security</i>&nbsp; CM User Audit</h1>
  <p class="flow-text">Gives CM clients ability to see which profiles have access to which parts of an account. Loads CM user profile mappings using the API into BigQuery and connects to a DataStudio dashboard.</p>

  <a class="trigger_category menu_link waves-effect waves-dark btn-flat grey lighten-2" href="/starthinker/solution/">All</a>
  
    <a class="trigger_category menu_link waves-effect waves-dark btn-flat grey lighten-2" href="/starthinker/solution/?category=insights">insights</a>
  
    <a class="trigger_category menu_link waves-effect waves-dark btn-flat grey lighten-2" href="/starthinker/solution/?category=experience">experience</a>
  

  <br/><br/>
  
    <a class="trigger_category menu_link waves-effect waves-dark btn-flat grey lighten-3" href="/starthinker/solution/?category=cm">cm</a>
  
    <a class="trigger_category menu_link waves-effect waves-dark btn-flat grey lighten-3" href="/starthinker/solution/?category=datastudio">datastudio</a>
  
    <a class="trigger_category menu_link waves-effect waves-dark btn-flat grey lighten-3" href="/starthinker/solution/?category=bigquery">bigquery</a>
  

  <br/><br/>
  
    <a class="trigger_category menu_link waves-effect waves-dark btn-flat grey lighten-4" href="/starthinker/solution/?category=security">security</a>
  
    <a class="trigger_category menu_link waves-effect waves-dark btn-flat grey lighten-4" href="/starthinker/solution/?category=reporting">reporting</a>
  

  <img id="solution_image" src="https://storage.googleapis.com/starthinker-ui/barnacle.png"/>

  <div class="buttons">

    <a class="btn-large blue waves-effect waves-light" href="https://groups.google.com/d/forum/starthinker-assets" target="_blank">
      <i class="material-icons right">lock_open</i>Get Access
    </a>

    
      <a class="btn-large blue waves-effect waves-light" href="https://datastudio.google.com/open/1gjxHm0jUlQUd0jMuxaOlmrl8gOX1kyKT" target="_blank">
        <i class="material-icons right">directions_bike</i>Sample
      </a>
    

    

    

    <br/>

    

    
      <a class="btn-large blue waves-effect waves-light" href="https://github.com/google/starthinker/blob/master/scripts/barnacle.json" target="_blank">
        <i class="material-icons right">list</i>Git Hub
      </a>
      <a class="btn-large blue waves-effect waves-light" href="https://colab.research.google.com/github/google/starthinker/blob/master/colabs/barnacle.ipynb" target="_blank">
        <i class="material-icons right">copyright</i>Data Pill Colab
      </a>
      <a class="btn-large blue waves-effect waves-light" href="https://github.com/google/starthinker/blob/master/dags/barnacle_dag.py" target="_blank">
        <i class="material-icons right">copyright</i>Airflow DAG
      </a>
    

  </div>

  <br/><br/>

  <div class="row">
    
      <div class="col s12 m6 l4">
        <div class="card">
          <table class="bordered">
            <thead>
              <tr>
                <th>Value Proposition</th>
              </tr>
             </thead>
             <tbody>
             
               <tr>
                 <td>Meet contractual access reporting information.</td>
               </tr>
             
               <tr>
                 <td>Reduce unauthorized use of CM accounts and assets.</td>
               </tr>
             
               <tr>
                 <td>Audit user access within CM.</td>
               </tr>
             
               <tr>
                 <td>Prevent malicious user access / behavior.</td>
               </tr>
             
             </tbody>
          </table>
        </div>
      </div>
    
  
    
      <div class="col s12 m6 l4">
        <div class="card">
          <table class="bordered">
            <thead>
              <tr>
                <th>Impact</th>
                <th>Level</th>
              </tr>
             </thead>
               <tbody>
               
                 <tr>
                   <td>Spend Optimization</td>
                   <td>
                     <div class="progress">
                       <div class="determinate" style="width: 0%"></div>
                     </div>
                   </td>
                 </tr>
               
                 <tr>
                   <td>Spend Growth</td>
                   <td>
                     <div class="progress">
                       <div class="determinate" style="width: 0%"></div>
                     </div>
                   </td>
                 </tr>
               
                 <tr>
                   <td>Time Savings</td>
                   <td>
                     <div class="progress">
                       <div class="determinate" style="width: 90%"></div>
                     </div>
                   </td>
                 </tr>
               
                 <tr>
                   <td>Account Health</td>
                   <td>
                     <div class="progress">
                       <div class="determinate" style="width: 100%"></div>
                     </div>
                   </td>
                 </tr>
               
                 <tr>
                   <td>Csat Improvement</td>
                   <td>
                     <div class="progress">
                       <div class="determinate" style="width: 90%"></div>
                     </div>
                   </td>
                 </tr>
               
             </tbody>
          </table>
        </div> 
      </div> 
    

    <div class="col s12 m6 l4">
      <div class="card">
        <table class="bordered">
          <thead>
            <tr>
              <th colspan="2">Details</th>
            </tr>
           </thead>
          <tbody>
    
            
            <tr>
              <td colspan="2">This solution has anonymized data and is OK to share with clients.</td>
            </tr>
            
    
            <tr>
              <td>Authors</td>
              <td><a href="mailto:ceh@google.com,kenjora@google.com?subject=Request+For+A+CM+User+Audit+StarThinker+Solution&body=Hi%2C%0A%0AI%27d+like+to+learn+more+about+the+CM+User+Audit+solution.%0A%0AStarThinker+Link%3A+http%3A%2F%2Flocalhost%3A8000%2Fsolution%2Fbarnacle%2F%0A%0ACan+we+set+up+some+time+to+over+it%3F%0A%0AThanks" target="_blank">ceh@google.com<br/>kenjora@google.com</a>
              </td>
            </tr>
    
              </tbody>
        </table>
      </div>
    </div>
    
   
      <div class="col s12 m6 l4">
        <div class="card">
          <table class="bordered">
          <thead>
              <tr>
                <th>Instructions</th>
              </tr>
             </thead>
             <tbody>
             
               <tr>
                 <td>Wait for <b>BigQuery->UNDEFINED->UNDEFINED->CM_*</b> to be created.</td>
               </tr>
             
               <tr>
                 <td>Wait for <b>BigQuery->UNDEFINED->UNDEFINED->Barnacle_*</b> to be created, then copy and connect the following data sources.</td>
               </tr>
             
               <tr>
                 <td>Join the <a hre='https://groups.google.com/d/forum/starthinker-assets' target='_blank'>StarThinker Assets Group</a> to access the following assets</td>
               </tr>
             
               <tr>
                 <td>Copy <a href='https://datastudio.google.com/open/1a6K-XdPUzCYRXZp1ZcmeOUOURc9wn2Jj' target='_blank'>Barnacle Profile Advertiser Map</a> and connect.</td>
               </tr>
             
               <tr>
                 <td>Copy <a href='https://datastudio.google.com/open/1NEzrQWWnPjkD90iUwN-ASKbVBzoeBdoT' target='_blank'>Barnacle Profile Campaign Map</a> and connect.</td>
               </tr>
             
               <tr>
                 <td>Copy <a href='https://datastudio.google.com/open/1v_GRaitwPaHHKUzfJZYNBhzotvZ-bR7Y' target='_blank'>Barnacle Profile Site Map</a> and connect.</td>
               </tr>
             
               <tr>
                 <td>Copy <a href='https://datastudio.google.com/open/14tWlh7yiqzxKJIppMFVOw2MoMtQV_ucE' target='_blank'>Barnacle Profiles Connections</a> and connect.</td>
               </tr>
             
               <tr>
                 <td>Copy <a href='https://datastudio.google.com/open/1mavjxvHSEPfJq5aW4FYgCXsBCE5rthZG' target='_blank'>Barnacle Report Delivery Profiles</a> and connect.</td>
               </tr>
             
               <tr>
                 <td>Copy <a href='https://datastudio.google.com/open/1Azk_Nul-auinf4NnDq8T9fDyiKkUWD7A' target='_blank'>Barnacle Roles Duplicates</a> and connect.</td>
               </tr>
             
               <tr>
                 <td>Copy <a href='https://datastudio.google.com/open/1ogoofpKtqkLwcW9qC_Ju_JvJdIajsjNI' target='_blank'>Barnacle Roles Not Used</a> and connect.</td>
               </tr>
             
               <tr>
                 <td>Copy <a href='https://datastudio.google.com/open/1xLgZPjOPDtmPyEqYMiMbWwMI8-WTslfj' target='_blank'>Barnacle Site Contacts Profiles</a> and connect.</td>
               </tr>
             
               <tr>
                 <td>If reports checked, copy <a href='https://datastudio.google.com/open/1-YGDiQPDnk0gD78_QOY5XdTXRlTrLeEq' target='_blank'>Barnacle Profile Report Map</a> and connect.</td>
               </tr>
             
               <tr>
                 <td>Copy <a href='https://datastudio.google.com/open/1gjxHm0jUlQUd0jMuxaOlmrl8gOX1kyKT' target='_blank'>Barnacle Report</a>.</td>
               </tr>
             
               <tr>
                 <td>When prompted choose the new data sources you just created.</td>
               </tr>
             
               <tr>
                 <td>Or give these intructions to the client.</td>
               </tr>
             
             </tbody>
          </table>
        </div>
       </div>
     

    <div class="col s12 m12 l8">
      <pre class="card expand_code left-align"><span class="expand_code waves-light">Workflow<i class="material-icons medium">expand_more</i></span>[
    {
        &quot;dataset&quot;: {
            &quot;description&quot;: &quot;The dataset will hold multiple tables, amke sure it exists.&quot;,
            &quot;hour&quot;: [
                1
            ],
            &quot;auth&quot;: &quot;service&quot;,
            &quot;dataset&quot;: {
                &quot;field&quot;: {
                    &quot;name&quot;: &quot;dataset&quot;,
                    &quot;kind&quot;: &quot;string&quot;,
                    &quot;order&quot;: 1,
                    &quot;default&quot;: &quot;&quot;,
                    &quot;description&quot;: &quot;Name of Google BigQuery dataset to create.&quot;
                }
            }
        }
    },
    {
        &quot;barnacle&quot;: {
            &quot;description&quot;: &quot;Will create tables with format CM_* to hold each endpoint via a call to the API list function. Exclude reports for its own task.&quot;,
            &quot;hour&quot;: [
                1
            ],
            &quot;auth&quot;: &quot;user&quot;,
            &quot;endpoints&quot;: [
                &quot;accounts&quot;,
                &quot;subaccounts&quot;,
                &quot;profiles&quot;,
                &quot;advertisers&quot;,
                &quot;campaigns&quot;,
                &quot;sites&quot;,
                &quot;roles&quot;
            ],
            &quot;reports&quot;: false,
            &quot;accounts&quot;: {
                &quot;single_cell&quot;: true,
                &quot;values&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;accounts&quot;,
                        &quot;kind&quot;: &quot;integer_list&quot;,
                        &quot;order&quot;: 2,
                        &quot;default&quot;: [],
                        &quot;description&quot;: &quot;Comma separated CM account ids.&quot;
                    }
                }
            },
            &quot;out&quot;: {
                &quot;auth&quot;: &quot;service&quot;,
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;order&quot;: 1,
                        &quot;default&quot;: &quot;&quot;,
                        &quot;description&quot;: &quot;Google BigQuery dataset to create tables in.&quot;
                    }
                }
            }
        }
    },
    {
        &quot;barnacle&quot;: {
            &quot;description&quot;: &quot;Will create tables with format CM_* to hold each endpoint via a call to the API list function. Reports run long so seperate task.&quot;,
            &quot;hour&quot;: [
                3
            ],
            &quot;auth&quot;: &quot;user&quot;,
            &quot;endpoints&quot;: [],
            &quot;reports&quot;: {
                &quot;field&quot;: {
                    &quot;name&quot;: &quot;reports&quot;,
                    &quot;kind&quot;: &quot;boolean&quot;,
                    &quot;order&quot;: 3,
                    &quot;default&quot;: false,
                    &quot;description&quot;: &quot;Include report audit, consumes significant API and data.&quot;
                }
            },
            &quot;accounts&quot;: {
                &quot;single_cell&quot;: true,
                &quot;values&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;accounts&quot;,
                        &quot;kind&quot;: &quot;integer_list&quot;,
                        &quot;order&quot;: 2,
                        &quot;default&quot;: [],
                        &quot;description&quot;: &quot;Comma separated CM account ids.&quot;
                    }
                }
            },
            &quot;out&quot;: {
                &quot;auth&quot;: &quot;service&quot;,
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;order&quot;: 1,
                        &quot;default&quot;: &quot;&quot;,
                        &quot;description&quot;: &quot;Google BigQuery dataset to create tables in.&quot;
                    }
                }
            }
        }
    },
    {
        &quot;bigquery&quot;: {
            &quot;hour&quot;: [
                8
            ],
            &quot;description&quot;: &quot;Combine profile, account, subaccount, and roles into one view, used by other views in this workflow.&quot;,
            &quot;auth&quot;: &quot;service&quot;,
            &quot;from&quot;: {
                &quot;legacy&quot;: false,
                &quot;query&quot;: &quot; SELECT   P.profileId AS profileId,   P.accountId AS accountId,   P.subaccountId AS subaccountId,   P.name AS Profile_Name,    P.email AS Profile_Email,    REGEXP_EXTRACT(P.email, r&#39;@(.+)&#39;) AS Profile_Domain,   P.userAccessType AS Profile_userAccessType,    P.active AS Profie_active,    P.traffickerType AS Profile_traffickerType,    P.comments AS Profile_comments,   P.userRoleId AS Profile_userRoleId,    R.role_name AS Role_role_name,    R.role_defaultUserRole AS Role_role_defaultUserRole,    R.permission_name AS Role_permission_name,        R.permission_availability AS Role_permission_availability,   A.name AS Account_name,   A.active AS Account_active,   A.description AS Account_description,   A.locale AS Account_locale,   S.name AS SubAccount_name FROM `[PARAMETER].[PARAMETER].CM_Profiles` AS P  LEFT JOIN `[PARAMETER].[PARAMETER].CM_Roles` AS R    ON P.userRoleId=R.roleId LEFT JOIN `[PARAMETER].[PARAMETER].CM_Accounts` AS A    ON P.accountId=A.accountId LEFT JOIN `[PARAMETER].[PARAMETER].CM_SubAccounts` AS S    ON P.accountId=S.accountId   AND P.subaccountId=S.subaccountId ; &quot;,
                &quot;parameters&quot;: [
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    }
                ]
            },
            &quot;to&quot;: {
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                    }
                },
                &quot;view&quot;: &quot;Barnacle_Profile_Role_Account_SubAccount_Map&quot;
            }
        }
    },
    {
        &quot;bigquery&quot;: {
            &quot;description&quot;: &quot;Combine profiles and advertisers.&quot;,
            &quot;hour&quot;: [
                8
            ],
            &quot;auth&quot;: &quot;service&quot;,
            &quot;from&quot;: {
                &quot;legacy&quot;: false,
                &quot;query&quot;: &quot; SELECT   APRASM.*,   A.advertiserId AS advertiserId,   A.name AS Advertiser_name,    A.status AS Advertiser_status,    A.defaultEmail AS Advertiser_defaultEmail,    A.suspended AS Advertiser_suspended FROM `[PARAMETER].[PARAMETER].CM_Profile_Advertisers` As PA LEFT JOIN `[PARAMETER].[PARAMETER].Barnacle_Profile_Role_Account_SubAccount_Map` AS APRASM    ON PA.profileID=APRASM.profileID LEFT JOIN `[PARAMETER].[PARAMETER].CM_Advertisers` AS A    ON PA.advertiserId=A.advertiserId ; &quot;,
                &quot;parameters&quot;: [
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    }
                ]
            },
            &quot;to&quot;: {
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                    }
                },
                &quot;view&quot;: &quot;Barnacle_Profile_Advertiser_Map&quot;
            }
        }
    },
    {
        &quot;bigquery&quot;: {
            &quot;description&quot;: &quot;Profile to campaign mapping.&quot;,
            &quot;hour&quot;: [
                8
            ],
            &quot;auth&quot;: &quot;service&quot;,
            &quot;from&quot;: {
                &quot;legacy&quot;: false,
                &quot;query&quot;: &quot; SELECT   APRASM.*,   C.campaignId AS campaignId,   C.name AS Campaign_name,    C.archived AS Campaign_archived,   IF(C.startDate &lt;= CURRENT_DATE() AND C.endDate &gt;= CURRENT_DATE(), True, False) AS Campaign_running,   ROUND(TIMESTAMP_DIFF(CURRENT_TIMESTAMP(), C.lastModifiedInfo_time, DAY) / 7) AS Campaign_Modified_Weeks_Ago FROM `[PARAMETER].[PARAMETER].CM_Profile_Campaigns` As PC LEFT JOIN `[PARAMETER].[PARAMETER].Barnacle_Profile_Role_Account_SubAccount_Map` AS APRASM    ON PC.profileID=APRASM.profileID  LEFT JOIN `[PARAMETER].[PARAMETER].CM_Campaigns` AS C    ON PC.campaignId=C.campaignId ; &quot;,
                &quot;parameters&quot;: [
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    }
                ]
            },
            &quot;to&quot;: {
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                    }
                },
                &quot;view&quot;: &quot;Barnacle_Profile_Campaign_Map&quot;
            }
        }
    },
    {
        &quot;bigquery&quot;: {
            &quot;description&quot;: &quot;The logic query for Deal Finder, transforms report into view used by datastudio.&quot;,
            &quot;hour&quot;: [
                8
            ],
            &quot;auth&quot;: &quot;service&quot;,
            &quot;from&quot;: {
                &quot;legacy&quot;: false,
                &quot;query&quot;: &quot; SELECT   APRASM.*,   R.reportId AS reportId,   R.name AS Report_name,    R.type AS Report_type,   R.format AS Report_format,   R.schedule_active AS Report_schedule_active,   R.schedule_repeats AS Report_schedule_repeats,   ROUND(TIMESTAMP_DIFF(CURRENT_TIMESTAMP(), R.lastModifiedTime, DAY) / 7) AS Report_Modified_Weeks_Ago,   DATE_DIFF(R.schedule_expirationDate, CURRENT_DATE(), MONTH) AS Report_Schedule_Weeks_To_Go FROM `[PARAMETER].[PARAMETER].CM_Reports` As R LEFT JOIN `[PARAMETER].[PARAMETER].Barnacle_Profile_Role_Account_SubAccount_Map` AS APRASM    ON R.profileID=APRASM.profileID ; &quot;,
                &quot;parameters&quot;: [
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    }
                ]
            },
            &quot;to&quot;: {
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                    }
                },
                &quot;view&quot;: &quot;Barnacle_Profile_Report_Map&quot;
            }
        }
    },
    {
        &quot;bigquery&quot;: {
            &quot;description&quot;: &quot;The logic query for Deal Finder, transforms report into view used by datastudio.&quot;,
            &quot;hour&quot;: [
                8
            ],
            &quot;auth&quot;: &quot;service&quot;,
            &quot;from&quot;: {
                &quot;legacy&quot;: false,
                &quot;query&quot;: &quot; SELECT   APRASM.*,   S.siteId AS siteId,   S.name AS Site_Name,    S.keyName AS Site_keyName,    S.approved AS Site_approved FROM `[PARAMETER].[PARAMETER].CM_Profile_Sites` As PS LEFT JOIN `[PARAMETER].[PARAMETER].Barnacle_Profile_Role_Account_SubAccount_Map` AS APRASM    ON PS.profileID=APRASM.profileID  LEFT JOIN `[PARAMETER].[PARAMETER].CM_Sites` AS S    ON PS.siteId=S.siteId ; &quot;,
                &quot;parameters&quot;: [
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    }
                ]
            },
            &quot;to&quot;: {
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                    }
                },
                &quot;view&quot;: &quot;Barnacle_Profile_Site_Map&quot;
            }
        }
    },
    {
        &quot;bigquery&quot;: {
            &quot;description&quot;: &quot;The logic query for Deal Finder, transforms report into view used by datastudio.&quot;,
            &quot;hour&quot;: [
                8
            ],
            &quot;auth&quot;: &quot;service&quot;,
            &quot;from&quot;: {
                &quot;legacy&quot;: false,
                &quot;query&quot;: &quot; SELECT    APRASM.* FROM `[PARAMETER].[PARAMETER].Barnacle_Profile_Role_Account_SubAccount_Map` AS APRASM LEFT JOIN `[PARAMETER].[PARAMETER].CM_Profile_Advertisers` AS PA    ON APRASM.profileId=PA.profileId  LEFT JOIN `[PARAMETER].[PARAMETER].CM_Profile_Campaigns` AS PC    ON APRASM.profileId=PC.profileId  LEFT JOIN `[PARAMETER].[PARAMETER].CM_Profile_Sites` AS PS   ON APRASM.profileId=PS.profileId  WHERE   PA.advertiserId IS NULL   AND PC.campaignId IS NULL   AND PS.siteId IS NULL  &quot;,
                &quot;parameters&quot;: [
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    }
                ]
            },
            &quot;to&quot;: {
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                    }
                },
                &quot;view&quot;: &quot;Barnacle_Profiles_Connections&quot;
            }
        }
    },
    {
        &quot;bigquery&quot;: {
            &quot;description&quot;: &quot;&quot;,
            &quot;hour&quot;: [
                8
            ],
            &quot;auth&quot;: &quot;service&quot;,
            &quot;from&quot;: {
                &quot;legacy&quot;: false,
                &quot;query&quot;: &quot; SELECT   RD.accountId AS accountId,   RD.subaccountId AS subaccountId,   RD.reportId AS reportId,   A.name AS Account_name,   A.active AS Account_active,   SA.name as SubAccount_name,   R.name as Report_name,   R.schedule_active AS Report_schedule_active,   RD.emailOwnerDeliveryType AS Delivery_emailOwnerDeliveryType,   RD.deliveryType AS Delivery_deliveryType,   RD.email AS Delivery_email,   RD.message AS Delivery_message,   IF(RD.email in (SELECT email from `[PARAMETER].[PARAMETER].CM_Profiles`), True, False) AS Profile_Match_Exists FROM `[PARAMETER].[PARAMETER].CM_Report_Deliveries` AS RD  LEFT JOIN `[PARAMETER].[PARAMETER].CM_Accounts` AS A    ON RD.accountId=A.accountId LEFT JOIN `[PARAMETER].[PARAMETER].CM_SubAccounts` AS SA    ON RD.subaccountId=SA.subaccountId LEFT JOIN `[PARAMETER].[PARAMETER].CM_Reports` AS R    ON RD.reportId=R.reportId &quot;,
                &quot;parameters&quot;: [
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    }
                ]
            },
            &quot;to&quot;: {
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                    }
                },
                &quot;view&quot;: &quot;Barnacle_Report_Delivery_Profiles&quot;
            }
        }
    },
    {
        &quot;bigquery&quot;: {
            &quot;description&quot;: &quot;&quot;,
            &quot;hour&quot;: [
                8
            ],
            &quot;auth&quot;: &quot;service&quot;,
            &quot;from&quot;: {
                &quot;legacy&quot;: false,
                &quot;query&quot;: &quot; SELECT   R.accountId AS accountId,   R.subaccountId AS subaccountId,   R.roleId AS roleId,   A.name AS Account_name,   A.active AS Account_active,   SA.name AS SubAccount_name,   R.role_name as Role_role_name,   R.role_defaultUserRole AS Role_role_defaultUserRole,   R.permission_name AS Role_permission_name,   R.permission_availability AS Role_permission_availability   FROM `[PARAMETER].[PARAMETER].CM_Roles` AS R LEFT JOIN `[PARAMETER].[PARAMETER].CM_Accounts` AS A on R.accountId=A.accountId LEFT JOIN `[PARAMETER].[PARAMETER].CM_SubAccounts` AS SA on R.subaccountId=SA.subaccountId WHERE roleId NOT IN (   SELECT roleId FROM `[PARAMETER].[PARAMETER].CM_Profile_Roles`  ) &quot;,
                &quot;parameters&quot;: [
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    }
                ]
            },
            &quot;to&quot;: {
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                    }
                },
                &quot;view&quot;: &quot;Barnacle_Roles_Not_Used&quot;
            }
        }
    },
    {
        &quot;bigquery&quot;: {
            &quot;description&quot;: &quot;&quot;,
            &quot;hour&quot;: [
                8
            ],
            &quot;auth&quot;: &quot;service&quot;,
            &quot;from&quot;: {
                &quot;legacy&quot;: false,
                &quot;query&quot;: &quot; SELECT   SC.accountId AS accountId,   SC.subaccountId AS subaccountId,   SC.siteId AS siteId,   SC.contactId AS contactId,   A.name AS Account_name,   A.active AS Account_active,   SA.name as SubAccount_name,   S.name as Site_name,   S.approved AS Site_approved,   SC.email AS Site_Contact_email,   CONCAT(SC.firstName, &#39; &#39;, sc.lastname) AS Site_Contact_Name,   SC.phone AS Site_Contact_phone,   SC.contactType AS Site_Contact_contactType,   IF(sc.email in (SELECT email from `[PARAMETER].[PARAMETER].CM_Profiles`), True, False) AS Profile_Match_Exists FROM `[PARAMETER].[PARAMETER].CM_Site_Contacts` AS SC  LEFT JOIN `[PARAMETER].[PARAMETER].CM_Accounts` AS A    ON SC.accountId=A.accountId LEFT JOIN `[PARAMETER].[PARAMETER].CM_SubAccounts` AS SA    ON SC.accountId=SA.accountId    AND SC.subaccountId=SA.subaccountId LEFT JOIN `[PARAMETER].[PARAMETER].CM_Sites` AS S    ON SC.siteId=S.siteId ; &quot;,
                &quot;parameters&quot;: [
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    }
                ]
            },
            &quot;to&quot;: {
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                    }
                },
                &quot;view&quot;: &quot;Barnacle_Site_Contacts_Profiles&quot;
            }
        }
    },
    {
        &quot;bigquery&quot;: {
            &quot;description&quot;: &quot;&quot;,
            &quot;hour&quot;: [
                8
            ],
            &quot;auth&quot;: &quot;service&quot;,
            &quot;from&quot;: {
                &quot;legacy&quot;: false,
                &quot;query&quot;: &quot; WITH   profile_counts AS (   SELECT userRoleId, COUNT(profileId) as profile_count   FROM `[PARAMETER].[PARAMETER].CM_Profiles`   GROUP BY 1  ),  permission_fingerprints AS (   SELECT     accountId,     subaccountId,     roleId,     role_name,     role_defaultUserRole,     SUM(profile_count) AS profile_count,     FARM_FINGERPRINT(       ARRAY_TO_STRING(       ARRAY_AGG(         DISTINCT permission_name ORDER BY permission_name ASC       ), &#39;,&#39;, &#39;-&#39;     )   ) AS permissions_fingerprint   FROM     `[PARAMETER].[PARAMETER].CM_Roles` AS R   LEFT JOIN profile_counts AS P   ON R.roleId = P.userRoleId   GROUP BY     accountId,     subaccountId,     roleId,     role_name,     role_defaultUserRole )  SELECT    PFL.accountId AS accountId,   A.name AS Account_name,   A.active AS Account_active,   PFL.subaccountId AS subaccountId,    SA.name AS SubAccount_name,   PFL.roleId AS roleId,   PFL.role_name AS role_name,   PFL.role_defaultUserRole AS role_defaultUserRole,   COALESCE(PFL.profile_count, 0) AS profile_count,   PFR.roleId AS duplicate_roleId,   PFR.role_name AS duplicate_role_name,   PFR.role_defaultUserRole AS duplicate_role_defaultUserRole,   COALESCE(PFR.profile_count, 0) AS duplicate_profile_count FROM permission_fingerprints AS PFL LEFT JOIN `[PARAMETER].[PARAMETER].CM_Accounts` AS A on PFL.accountId=A.accountId LEFT JOIN `[PARAMETER].[PARAMETER].CM_SubAccounts` AS SA on PFL.subaccountId=SA.subaccountId LEFT JOIN permission_fingerprints AS PFR    ON PFL.permissions_fingerprint=PFR.permissions_fingerprint   AND PFL.accountId=PFR.accountId   AND COALESCE(PFL.subaccountId, 0)=COALESCE(PFR.subaccountId, 0) WHERE PFL.roleId != PFR.roleId ; &quot;,
                &quot;parameters&quot;: [
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;recipe_project&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Project where BigQuery dataset will be created.&quot;
                        }
                    },
                    {
                        &quot;field&quot;: {
                            &quot;name&quot;: &quot;dataset&quot;,
                            &quot;kind&quot;: &quot;string&quot;,
                            &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                        }
                    }
                ]
            },
            &quot;to&quot;: {
                &quot;dataset&quot;: {
                    &quot;field&quot;: {
                        &quot;name&quot;: &quot;dataset&quot;,
                        &quot;kind&quot;: &quot;string&quot;,
                        &quot;description&quot;: &quot;Place where tables will be written in BigQuery.&quot;
                    }
                },
                &quot;view&quot;: &quot;Barnacle_Roles_Duplicates&quot;
            }
        }
    }
]</pre>
    </div>

  </div>

  <br/><br/>
  <h3 id="code-tasks">Run This Workflow In Minutes On Google Cloud</h3>
  <p class="flow-text">Everything from a quick Google Cloud UI to reference developer code for your team in one GitHub repository.</p>
  <p>
    <a href="https://github.com/google/starthinker/blob/master/tutorials/README.md#deployment" class="waves-effect waves-light btn blue form_button modal-trigger" target="_blank">
      Deployment Steps<i class="material-icons right">launch</i>
    </a>
    <a href="https://github.com/google/starthinker/blob/master/tutorials/README.md#development" class="waves-effect waves-light btn blue form_button modal-trigger" target="_blank">
      Developer Guide<i class="material-icons right">build</i>
    </a>
    <a href="https://github.com/google/starthinker/blob/master/tutorials/ui_recipe.md" class="waves-effect waves-light btn blue form_button modal-trigger" target="_blank">
      UI How To<i class="material-icons right">laptop</i>
    </a>
  </p>



    </div>

  </body>

  

<footer class="page-footer red lighten-1">
  <div class="footer-copyright">
    <div class="container center">
    &copy; 2019 Google, Inc
    </div>
  </div>
</footer>


  <script type="text/javascript">
    $(document).ready(function() {
      $(".button-collapse").sideNav();
      $('select').material_select();
      $('.modal').modal();
    });
  </script>

  
  <script type="text/javascript">
    $(document).ready(function() {
      $('span.expand_code').on('click tap', function() {
        $('pre.expand_code').css('height', 'auto');
        $(this).hide();
      });
    });
  </script>


</html>
